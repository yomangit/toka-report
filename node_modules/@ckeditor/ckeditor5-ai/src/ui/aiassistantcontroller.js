/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x4497f4=_0x23f0;(function(_0x4cec37,_0x5d6c8d){const _0x55caea=_0x23f0,_0x567b18=_0x4cec37();while(!![]){try{const _0x298112=-parseInt(_0x55caea(0x1de))/0x1*(-parseInt(_0x55caea(0x1f9))/0x2)+parseInt(_0x55caea(0x232))/0x3+parseInt(_0x55caea(0x1e3))/0x4*(-parseInt(_0x55caea(0x1e1))/0x5)+-parseInt(_0x55caea(0x1e2))/0x6*(-parseInt(_0x55caea(0x223))/0x7)+-parseInt(_0x55caea(0x1ee))/0x8+parseInt(_0x55caea(0x23a))/0x9*(-parseInt(_0x55caea(0x21d))/0xa)+parseInt(_0x55caea(0x1dd))/0xb;if(_0x298112===_0x5d6c8d)break;else _0x567b18['push'](_0x567b18['shift']());}catch(_0xcd9080){_0x567b18['push'](_0x567b18['shift']());}}}(_0x39a0,0xcdb7c));import{ObservableMixin as _0x1b5638}from'ckeditor5/src/utils.js';import{AIRequestError as _0x58e04e}from'../adapters/aiadapter.js';import{Matcher as _0x2d97b8,ViewUpcastWriter as _0xaa2dc6}from'ckeditor5/src/engine.js';const Q=new RegExp(/^(.*?)<[a-zA-Z][a-zA-Z0-9_\-.]*[ >]/,'is');function _0x23f0(_0x1a6e4f,_0x4fa7a2){const _0x39a095=_0x39a0();return _0x23f0=function(_0x23f086,_0x57fc47){_0x23f086=_0x23f086-0x1dc;let _0xa6d95d=_0x39a095[_0x23f086];return _0xa6d95d;},_0x23f0(_0x1a6e4f,_0x4fa7a2);}function _0x39a0(){const _0x4316ff=['from','startProcessing','currentContext','once','380177EGwDTn','text/html','previousContext','querySelector','rename','stringify','remove','exec','editing','```html','get','_domParser','toModel','name','stopProcessing','2328030jROOur','initialContext','substring','previousLabel','submitPrompt','_parseAndNormalizeContent','_xmlSerializer','createElement','163647jpuGTY','element','endsWith','set','finishProcessing','isRendered','finally','custom','10919964LTtJGK','919417hqglwi','processor','_stripMarkdownSyntax','24685FkKRiz','12LRNVxB','136xripae','message','updateView','match','document','ELEMENT_NODE','htmlProcessor','childNodes','config','currentResponse','innerHTML','10799224rCXVTr','reverse','push','data','clear','<h1></h1>','domConverter','parseFromString','prompt','makeRequest','destroy','2PFhbXy','nodeType','setContentOf','textAdapter','previousActionId','_sanitizationContainer','viewToDom','```','abort','view','set:currentContext','catch','trim','_normalizeResponseHeadings','_sanitizeHTML','toView','serializeToString','isProcessing','startsWith','stopListening','div','markers','tryAgainEvent','editor','reset','length','_handleQuery','_isH1TagSupportEnabled','listenTo','mainAction','body','previousQuery','value','then','ai.aiAssistant.preserveComments','handleError','240yKDrvO','render'];_0x39a0=function(){return _0x4316ff;};return _0x39a0();}export class AIAssistantController extends/* #__PURE__ -- @preserve */
_0x1b5638(){[_0x4497f4(0x210)];[_0x4497f4(0x1fc)];[_0x4497f4(0x202)];[_0x4497f4(0x1fe)];[_0x4497f4(0x22e)];[_0x4497f4(0x238)];constructor(_0x2ab586,_0x3fd6ea,_0x336e32){const _0x179f57=_0x4497f4;super(),this[_0x179f57(0x210)]=_0x2ab586,this[_0x179f57(0x1fc)]=_0x3fd6ea,this[_0x179f57(0x1fe)]=document[_0x179f57(0x239)](_0x179f57(0x20d)),this[_0x179f57(0x22e)]=new DOMParser(),this[_0x179f57(0x238)]=new XMLSerializer(),this[_0x179f57(0x202)]=_0x336e32,this[_0x179f57(0x23d)]({'initialContext':'','currentContext':'','currentResponse':'','previousContext':void 0x0,'previousQuery':void 0x0,'previousLabel':void 0x0,'isProcessing':!0x1}),this['on'](_0x179f57(0x203),(_0x168be4,_0xc3199f,_0x130e93)=>{const _0x51ddce=_0x179f57;this[_0x51ddce(0x202)][_0x51ddce(0x219)]=this[_0x51ddce(0x207)](_0x130e93);}),this[_0x179f57(0x215)](this[_0x179f57(0x202)],_0x179f57(0x236),(_0x16b3a3,_0x32a43d)=>{const _0x139222=_0x179f57,_0x20e41a=this[_0x139222(0x221)]||this[_0x139222(0x233)];this[_0x139222(0x213)](_0x32a43d,_0x20e41a,_0x139222(0x1dc));}),this[_0x179f57(0x215)](this[_0x179f57(0x202)],_0x179f57(0x20f),()=>{const _0x52fd5a=_0x179f57;this[_0x52fd5a(0x202)][_0x52fd5a(0x1f6)]=this[_0x52fd5a(0x235)],this[_0x52fd5a(0x213)](this[_0x52fd5a(0x218)],this[_0x52fd5a(0x225)],this[_0x52fd5a(0x1fd)],this[_0x52fd5a(0x235)]);}),this[_0x179f57(0x215)](this[_0x179f57(0x202)],_0x179f57(0x231),()=>{const _0x3b4d1f=_0x179f57;this[_0x3b4d1f(0x231)]();});}[_0x4497f4(0x1f8)](){const _0x322a8a=_0x4497f4;this[_0x322a8a(0x20c)]();}async[_0x4497f4(0x1e5)]({actionId:_0x247d29,query:_0x4cf0c4,htmlContent:_0x4c082f,label:_0x116deb,mainActionLabel:_0x375aa1}){const _0x211384=_0x4497f4;this[_0x211384(0x202)][_0x211384(0x1f6)]=_0x116deb,this[_0x211384(0x202)][_0x211384(0x216)]=_0x375aa1,this[_0x211384(0x233)]=_0x4c082f,_0x4cf0c4&&(this[_0x211384(0x202)][_0x211384(0x23f)]?this[_0x211384(0x213)](_0x4cf0c4,_0x4c082f,_0x247d29,_0x116deb):this[_0x211384(0x202)][_0x211384(0x222)](_0x211384(0x21e),()=>{const _0x5d3db=_0x211384;this[_0x5d3db(0x213)](_0x4cf0c4,_0x4c082f,_0x247d29,_0x116deb);}));}[_0x4497f4(0x231)](){const _0x138ce5=_0x4497f4;this[_0x138ce5(0x20a)]&&(this[_0x138ce5(0x20a)]=!0x1,this[_0x138ce5(0x202)][_0x138ce5(0x23e)](),this[_0x138ce5(0x1fc)][_0x138ce5(0x201)]());}[_0x4497f4(0x211)](){const _0x20ca40=_0x4497f4;this[_0x20ca40(0x233)]='',this[_0x20ca40(0x221)]='',this[_0x20ca40(0x1ec)]='',this[_0x20ca40(0x225)]='',this[_0x20ca40(0x218)]='',this[_0x20ca40(0x235)]='',this[_0x20ca40(0x1fd)]=void 0x0,this[_0x20ca40(0x202)][_0x20ca40(0x211)](),this[_0x20ca40(0x231)]();}async[_0x4497f4(0x213)](_0xd3a768,_0x5722e7,_0x55ef0a,_0x54e589){const _0x5f4e49=_0x4497f4;return this[_0x5f4e49(0x20a)]=!0x0,this[_0x5f4e49(0x202)][_0x5f4e49(0x220)](),this[_0x5f4e49(0x225)]=_0x5722e7,this[_0x5f4e49(0x218)]=_0xd3a768,this[_0x5f4e49(0x235)]=_0x54e589||_0xd3a768,this[_0x5f4e49(0x1fd)]=_0x55ef0a,new Promise(_0x1611db=>{const _0x460cab=_0x5f4e49;this[_0x460cab(0x1fc)][_0x460cab(0x1f7)]({'query':_0xd3a768,'context':_0x5722e7,'onData':_0xa2f32=>{const _0x5ba286=_0x460cab;this[_0x5ba286(0x1ec)]=_0xa2f32,this[_0x5ba286(0x221)]=this[_0x5ba286(0x237)](this[_0x5ba286(0x1ec)]);},'actionId':_0x55ef0a})[_0x460cab(0x21a)](()=>{const _0x47195f=_0x460cab;!this[_0x47195f(0x221)]&&this[_0x47195f(0x1ec)]&&(this[_0x47195f(0x221)]=this[_0x47195f(0x237)](this[_0x47195f(0x1ec)],!0x0));})[_0x460cab(0x204)](_0x3743be=>{const _0x164656=_0x460cab;_0x3743be instanceof _0x58e04e?this[_0x164656(0x202)][_0x164656(0x21c)](_0x3743be[_0x164656(0x1e4)]):this[_0x164656(0x202)][_0x164656(0x21c)](),_0x1611db();})[_0x460cab(0x240)](()=>{const _0x43d045=_0x460cab;this[_0x43d045(0x231)](),_0x1611db();});});}[_0x4497f4(0x237)](_0x552d99,_0x1d975f=!0x1){const _0x2a9863=_0x4497f4,_0x49c5eb=Q[_0x2a9863(0x22a)](_0x552d99);_0x552d99=_0x49c5eb?_0x552d99[_0x2a9863(0x234)](_0x49c5eb[0x1][_0x2a9863(0x212)]):_0x552d99[_0x2a9863(0x212)]<0x64&&!_0x1d975f?'':this[_0x2a9863(0x1e0)](_0x552d99);const _0x156e19=this[_0x2a9863(0x22e)][_0x2a9863(0x1f5)](_0x552d99,_0x2a9863(0x224));if(_0x49c5eb){const _0x35bb1b=Array[_0x2a9863(0x21f)](_0x156e19[_0x2a9863(0x217)][_0x2a9863(0x1ea)]);_0x35bb1b[_0x2a9863(0x1ef)]();for(const _0x3fd030 of _0x35bb1b){if(_0x3fd030[_0x2a9863(0x1fa)]==Node[_0x2a9863(0x1e8)])break;_0x3fd030[_0x2a9863(0x229)]();}}const _0x1fe538=this[_0x2a9863(0x210)][_0x2a9863(0x1f1)][_0x2a9863(0x1df)][_0x2a9863(0x208)](this[_0x2a9863(0x238)][_0x2a9863(0x209)](_0x156e19[_0x2a9863(0x217)]));this[_0x2a9863(0x214)]()||this[_0x2a9863(0x206)](_0x1fe538);const _0x329cb7=this[_0x2a9863(0x210)][_0x2a9863(0x1eb)][_0x2a9863(0x22d)](_0x2a9863(0x21b)),_0xd2a460=this[_0x2a9863(0x210)][_0x2a9863(0x1f1)][_0x2a9863(0x22f)](_0x1fe538);return _0x329cb7||_0xd2a460[_0x2a9863(0x20e)][_0x2a9863(0x1f2)](),this[_0x2a9863(0x210)][_0x2a9863(0x1f1)][_0x2a9863(0x228)](_0xd2a460);}[_0x4497f4(0x206)](_0x39d020){const _0x388565=_0x4497f4,_0x28d69d=new _0xaa2dc6(this[_0x388565(0x210)][_0x388565(0x22b)][_0x388565(0x202)][_0x388565(0x1e7)]),_0x3a3c84=new _0x2d97b8({'name':/^h[1-5]$/}),_0x544bbe=[];let _0x329085=!0x1;for(const _0x514248 of _0x39d020)_0x514248['is'](_0x388565(0x23b))&&_0x3a3c84[_0x388565(0x1e6)](_0x514248)&&(_0x544bbe[_0x388565(0x1f0)](_0x514248),'h1'==_0x514248[_0x388565(0x230)]&&(_0x329085=!0x0));if(_0x329085){for(const _0x4cbd8f of _0x544bbe)_0x28d69d[_0x388565(0x227)]('h'+(parseInt(_0x4cbd8f[_0x388565(0x230)][0x1])+0x1),_0x4cbd8f);}}[_0x4497f4(0x214)](){const _0x462211=_0x4497f4,{data:_0x55e33a,editing:_0x4d7780}=this[_0x462211(0x210)],_0x5de43f=_0x55e33a[_0x462211(0x1e9)][_0x462211(0x208)](_0x462211(0x1f3)),_0x563c1c=_0x55e33a[_0x462211(0x208)](_0x55e33a[_0x462211(0x22f)](_0x5de43f));return!!_0x4d7780[_0x462211(0x202)][_0x462211(0x1f4)][_0x462211(0x1ff)](_0x563c1c)[_0x462211(0x226)]('h1');}[_0x4497f4(0x207)](_0x31a61c){const _0x5422e9=_0x4497f4;return this[_0x5422e9(0x210)][_0x5422e9(0x22b)][_0x5422e9(0x202)][_0x5422e9(0x1f4)][_0x5422e9(0x1fb)](this[_0x5422e9(0x1fe)],_0x31a61c),this[_0x5422e9(0x1fe)][_0x5422e9(0x1ed)];}[_0x4497f4(0x1e0)](_0x5b1bff){const _0x1b2cf5=_0x4497f4,_0x5a65ac=_0x5b1bff[_0x1b2cf5(0x205)]();return _0x5a65ac[_0x1b2cf5(0x20b)](_0x1b2cf5(0x22c))?_0x5a65ac[_0x1b2cf5(0x23c)](_0x1b2cf5(0x200))?_0x5a65ac[_0x1b2cf5(0x234)](0x7,_0x5a65ac[_0x1b2cf5(0x212)]-0x3):_0x5a65ac[_0x1b2cf5(0x234)](0x7):_0x5b1bff;}}